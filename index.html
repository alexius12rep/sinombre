<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizador Acad√©mico Inteligente</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <!-- Font Audiowide -->
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
    <!-- Font Awesome para √≠conos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --color-primary: #050916;
            --color-secondary: #0b5657;
            --color-accent: #0d3430;
            --color-light: #ffffff;
            --color-dark: #0080ff;
            --color-success: #28a745;
            --color-danger: #dc3545;
            --color-warning: #ffc107;
            --color-info: #032711;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
            --header-height: 50px;
            --settings-btn-size: 50px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            min-height: 100vh;
            color: var(--color-text);
            overflow-x: hidden;
            position: relative;
            transition: background 0.3s, color 0.3s;
        }

        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('logosinfondo.png');
            background-size: 30%;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.1;
            z-index: -1;
            pointer-events: none;
            background-attachment: fixed;
        }

        /* Header superior */
        .top-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--header-height);
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
            border-bottom: 1px solid var(--color-border);
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .google-icon {
            width: 24px;
            height: 24px;
            margin-right: 5px;
        }

        .auth-btn {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }

        .auth-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .auth-btn.login {
            background: var(--color-accent);
        }

        .auth-btn.register {
            background: var(--color-secondary);
        }

        /* Bot√≥n de configuraci√≥n flotante */
        .settings-btn-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .settings-btn {
            width: var(--settings-btn-size);
            height: var(--settings-btn-size);
            border-radius: 50%;
            background: var(--color-accent);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            position: relative;
        }

        .settings-btn:hover {
            transform: scale(1.1) rotate(30deg);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .settings-btn::after {
            content: 'Configuraci√≥n';
            position: absolute;
            bottom: 0;
            right: calc(100% + 10px);
            white-space: nowrap;
            background: var(--color-accent);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .settings-btn:hover::after {
            opacity: 1;
        }

        .settings-icon {
            font-size: 1.5rem;
            color: white;
        }

        .settings-menu {
            position: absolute;
            bottom: calc(var(--settings-btn-size) + 10px);
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 10px 0;
            min-width: 250px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1001;
            border: 1px solid var(--color-border);
        }

        .settings-menu.active {
            display: block;
        }

        .settings-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--color-text);
        }

        .settings-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .settings-item.logout {
            color: var(--color-danger);
        }

        .theme-options {
            display: none;
            flex-direction: column;
            padding: 10px;
            gap: 5px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            margin: 5px;
        }

        .theme-options.active {
            display: flex;
        }

        .theme-option {
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            border: 1px solid var(--color-border);
            transition: all 0.3s;
            color: white;
            text-align: center;
            position: relative;
        }

        .theme-option:hover {
            transform: scale(1.02);
        }

        .theme-option.active::after {
            content: '‚úì';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
        }

        /* Di√°logo personalizado */
        .custom-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            z-index: 1100;
            display: none;
            flex-direction: column;
            align-items: center;
            border: 1px solid var(--color-border);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            max-width: 80%;
            width: 300px;
        }

        .custom-dialog.active {
            display: flex;
        }

        .custom-dialog-message {
            margin-bottom: 20px;
            text-align: center;
        }

        .custom-dialog-buttons {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        .custom-dialog-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .custom-dialog-btn.confirm {
            background: var(--color-danger);
            color: white;
        }

        .custom-dialog-btn.cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-text);
        }

        .custom-dialog-btn:hover {
            opacity: 0.9;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
            padding-top: var(--header-height);
        }

        /* Logo y t√≠tulo */
        .logo-title {
            font-family: 'Audiowide', cursive;
            font-size: 1.8rem;
            color: var(--color-text);
            text-align: center;
            padding: 20px 0 10px 0;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: 20px;
        }

        /* Men√∫ lateral */
        .sidebar {
            width: 250px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            padding: 0 20px 20px 20px;
            transition: transform 0.3s;
            border-right: 1px solid var(--color-border);
            position: relative;
            z-index: 10;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--color-text);
        }

        .close-sidebar {
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.5rem;
            cursor: pointer;
            display: none;
        }

        .materias-list {
            overflow-y: auto;
            max-height: calc(100vh - 220px);
        }

        .materia-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            background: var(--color-bg-input);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .materia-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .materia-item.active {
            background: var(--color-accent);
            font-weight: bold;
        }

        .materia-info {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 5px;
            color: var(--color-text-secondary);
        }

        .materia-actions {
            display: none;
        }

        .materia-item:hover .materia-actions {
            display: flex;
            gap: 5px;
        }

        .materia-btn {
            background: none;
            border: none;
            color: var(--color-text);
            cursor: pointer;
            font-size: 0.8rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .materia-btn.eliminar {
            background: var(--color-danger);
        }

        .materia-btn.eliminar:hover {
            background: #c82333;
        }

        .add-materia-btn {
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            background: var(--color-accent);
            border: none;
            border-radius: 8px;
            color: var(--color-text);
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .add-materia-btn:hover {
            background: #002343;
        }

        /* Login info */
        .login-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            background-color: white;
            padding: 2px;
        }

        .user-email {
            font-size: 0.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            color: var(--color-text);
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            margin-left: 10px;
        }

        /* Contenido principal */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            position: relative;
            z-index: 1;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .menu-btn {
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.5rem;
            cursor: pointer;
            display: none;
        }

        .app-title {
            font-size: 2rem;
            font-weight: bold;
            color: var(--color-text);
        }

        /* Tareas */
        .tareas-container {
            background: var(--color-bg-input);
            backdrop-filter: blur(5px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--color-border);
            color: var(--color-text);
        }

        .tarea-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            animation: fadeIn 0.5s ease-out;
        }

        .tarea-item:last-child {
            margin-bottom: 0;
        }

        .tarea-info {
            flex: 1;
        }

        .tarea-title {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            color: var(--color-text);
        }

        .tarea-prioridad {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .prioridad-alta {
            background-color: #710101;
        }

        .prioridad-normal {
            background-color: #153704;
        }

        .tarea-descripcion {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
            color: var(--color-text-secondary);
        }

        .tarea-fecha {
            font-size: 0.8rem;
            color: var(--color-text-secondary);
        }

        .tarea-puntos {
            background: var(--color-accent);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
            color: white;
        }

        .tarea-actions {
            display: flex;
            gap: 10px;
        }

        .tarea-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tarea-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tarea-btn.completar {
            background: var(--color-success);
        }

        .tarea-btn.completar:hover {
            background: #218838;
        }

        .tarea-btn.eliminar {
            background: var(--color-danger);
        }

        .tarea-btn.eliminar:hover {
            background: #ff6b81;
        }

        .tarea-btn.editar {
            background: var(--color-warning);
        }

        .tarea-btn.editar:hover {
            background: #e0a800;
        }

        /* Modales */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            transition: transform 0.3s;
            border: 1px solid var(--color-border);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--color-text);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--color-text);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            background: var(--color-bg-input);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        .form-control.error {
            border-color: var(--color-danger);
            animation: vibrate 0.5s;
        }

        .error-message {
            color: var(--color-danger);
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }

        .tipo-tarea {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tipo-tarea-btn {
            flex: 1;
            padding: 10px;
            background: var(--color-bg-input);
            border: none;
            border-radius: 8px;
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.3s;
        }

        .tipo-tarea-btn.active {
            background: var(--color-accent);
            font-weight: bold;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--color-accent);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: #4f84ff;
            transform: translateY(-2px);
        }

        /* Secci√≥n de tareas completadas */
        .tareas-completadas-container {
            background: var(--color-bg-input);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .tarea-completada {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tarea-completada.entregada {
            background: rgba(40, 167, 69, 0.2);
            text-decoration: line-through;
        }

        .tarea-completada.no-entregada {
            background: rgba(220, 53, 69, 0.2);
            text-decoration: line-through;
        }

        .tarea-completada-info {
            flex: 1;
        }

        .tarea-completada-status {
            font-size: 0.8rem;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 10px;
        }

        .entregada-text {
            color: var(--color-success);
        }

        .no-entregada-text {
            color: var(--color-danger);
        }

        /* Login */
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            position: relative;
            z-index: 2;
            border: 1px solid var(--color-border);
        }

        .login-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            font-family: 'Audiowide', cursive;
            color: var(--color-text);
        }

        .auth-options {
            width: 100%;
            margin-top: 20px;
        }

        .login-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            background: #4285F4;
            color: white;
        }

        .login-btn:hover {
            background: #3367D6;
        }

        .login-btn img {
            width: 20px;
            height: 20px;
            background: white;
            padding: 5px;
            border-radius: 50%;
        }

        .skip-btn {
            background: none;
            border: none;
            color: var(--color-text);
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 5px;
        }

        .skip-btn:hover {
            color: #ffffff;
        }

        .terms {
            margin-top: 20px;
            font-size: 0.8rem;
            color: var(--color-text-secondary);
            text-align: center;
        }

        .terms-link {
            color: var(--color-text);
            text-decoration: none;
        }

        .terms-link:hover {
            text-decoration: underline;
        }

        /* Notificaciones */
        .notificacion {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 1001;
            animation: fadeIn 0.3s ease-out;
        }

        /* Configuraci√≥n de notificaciones */
        .notification-settings {
            display: none;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            margin: 5px;
        }

        .notification-settings.active {
            display: block;
        }

        .notification-setting {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-setting label {
            flex: 1;
        }

        .notification-setting select {
            padding: 5px;
            border-radius: 5px;
            background: var(--color-bg-input);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(10px); }
        }

        @keyframes vibrate {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: var(--header-height);
                left: 0;
                height: calc(100vh - var(--header-height));
                z-index: 100;
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .close-sidebar {
                display: block;
            }

            .menu-btn {
                display: block;
            }
            
            .background-image {
                background-size: 60%;
            }
        }

        /* Temas de color */
        .theme-dark {
            --color-primary: #050916;
            --color-secondary: #0b5657;
            --color-accent: #0d3430;
            --color-light: #ffffff;
            --color-dark: #0080ff;
            --color-success: #28a745;
            --color-danger: #dc3545;
            --color-warning: #ffc107;
            --color-info: #032711;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
        }

        .theme-light {
            --color-primary: #f5f5f5;
            --color-secondary: #e0e0e0;
            --color-accent: #4a90e2;
            --color-light: #333333;
            --color-dark: #2c3e50;
            --color-success: #2ecc71;
            --color-danger: #e74c3c;
            --color-warning: #f39c12;
            --color-info: #3498db;
            --color-text: #333333;
            --color-text-secondary: rgba(51, 51, 51, 0.7);
            --color-bg-input: rgba(0, 0, 0, 0.05);
            --color-border: rgba(0, 0, 0, 0.1);
        }

        .theme-purple {
            --color-primary: #1a0933;
            --color-secondary: #3d1a68;
            --color-accent: #6a3093;
            --color-light: #ffffff;
            --color-dark: #9b59b6;
            --color-success: #27ae60;
            --color-danger: #e74c3c;
            --color-warning: #f39c12;
            --color-info: #3498db;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
        }

        .theme-blue {
            --color-primary: #0a192f;
            --color-secondary: #172a45;
            --color-accent: #1e4d8c;
            --color-light: #ffffff;
            --color-dark: #64ffda;
            --color-success: #28a745;
            --color-danger: #dc3545;
            --color-warning: #ffc107;
            --color-info: #17a2b8;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
        }

        .theme-green {
            --color-primary: #0d1f0c;
            --color-secondary: #1a3a1a;
            --color-accent: #2a5e2a;
            --color-light: #ffffff;
            --color-dark: #4caf50;
            --color-success: #2e7d32;
            --color-danger: #c62828;
            --color-warning: #f9a825;
            --color-info: #0277bd;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
        }

        .theme-red {
            --color-primary: #1a0000;
            --color-secondary: #4a0000;
            --color-accent: #8b0000;
            --color-light: #ffffff;
            --color-dark: #ff4444;
            --color-success: #00c851;
            --color-danger: #ff4444;
            --color-warning: #ffbb33;
            --color-info: #33b5e5;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
        }

        .theme-midnight {
            --color-primary: #0a0e17;
            --color-secondary: #1a2138;
            --color-accent: #2a3a5e;
            --color-light: #ffffff;
            --color-dark: #6c8ae4;
            --color-success: #00b894;
            --color-danger: #d63031;
            --color-warning: #fdcb6e;
            --color-info: #0984e3;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
        }

        .theme-ocean {
            --color-primary: #001f3f;
            --color-secondary: #003366;
            --color-accent: #0074d9;
            --color-light: #ffffff;
            --color-dark: #7fdbff;
            --color-success: #2ecc40;
            --color-danger: #ff4136;
            --color-warning: #ffdc00;
            --color-info: #39cccc;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
        }

        .theme-forest {
            --color-primary: #0d2601;
            --color-secondary: #1a4003;
            --color-accent: #2a6607;
            --color-light: #ffffff;
            --color-dark: #4d9900;
            --color-success: #2e7d32;
            --color-danger: #c62828;
            --color-warning: #f9a825;
            --color-info: #0277bd;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
        }

        .theme-sunset {
            --color-primary: #1a0000;
            --color-secondary: #4a0000;
            --color-accent: #8b0000;
            --color-light: #ffffff;
            --color-dark: #ff4444;
            --color-success: #00c851;
            --color-danger: #ff4444;
            --color-warning: #ffbb33;
            --color-info: #33b5e5;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
        }

        .theme-black-white {
            --color-primary: #000000;
            --color-secondary: #333333;
            --color-accent: #666666;
            --color-light: #ffffff;
            --color-dark: #999999;
            --color-success: #ffffff;
            --color-danger: #ffffff;
            --color-warning: #ffffff;
            --color-info: #ffffff;
            --color-text: #ffffff;
            --color-text-secondary: rgba(255, 255, 255, 0.7);
            --color-bg-input: rgba(255, 255, 255, 0.1);
            --color-border: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="theme-dark">
    <!-- Imagen de fondo fija -->
    <div class="background-image"></div>

    <!-- Header superior -->
    <div class="top-header">
        <div class="auth-buttons" id="auth-buttons">
            <img src="googleimg.png" class="google-icon" alt="Google">
            <button class="auth-btn login" id="header-login-btn">Iniciar sesi√≥n</button>
            <button class="auth-btn register" id="header-register-btn">Registrarme</button>
        </div>
    </div>

    <!-- Bot√≥n de configuraci√≥n flotante -->
    <div class="settings-btn-container">
        <button class="settings-btn" id="settings-btn" title="Configuraci√≥n">
            <i class="fas fa-cog settings-icon"></i>
        </button>
        <div class="settings-menu" id="settings-menu">
            <div class="settings-item" id="change-theme-btn">
                <span>Cambiar tema</span>
                <span>üé®</span>
            </div>
            <div class="theme-options" id="theme-options">
                <div class="theme-option" data-theme="dark" style="background: #050916; color: white;">Oscuro</div>
                <div class="theme-option" data-theme="light" style="background: #f5f5f5; color: #333;">Claro</div>
                <div class="theme-option" data-theme="purple" style="background: #1a0933; color: white;">Morado</div>
                <div class="theme-option" data-theme="blue" style="background: #0a192f; color: white;">Azul</div>
                <div class="theme-option" data-theme="green" style="background: #0d1f0c; color: white;">Verde</div>
                <div class="theme-option" data-theme="red" style="background: #1a0000; color: white;">Rojo</div>
                <div class="theme-option" data-theme="midnight" style="background: #0a0e17; color: white;">Medianoche</div>
                <div class="theme-option" data-theme="ocean" style="background: #001f3f; color: white;">Oc√©ano</div>
                <div class="theme-option" data-theme="forest" style="background: #0d2601; color: white;">Bosque</div>
                <div class="theme-option" data-theme="black-white" style="background: #000000; color: white;">Blanco y Negro</div>
            </div>
            
            <div class="settings-item" id="notification-settings-btn">
                <span>Configurar notificaciones</span>
                <span>üîî</span>
            </div>
            <div class="notification-settings" id="notification-settings">
                <div class="notification-setting">
                    <label>Recordatorio tareas normales:</label>
                    <select id="reminder-normal">
                        <option value="1">1 d√≠a antes</option>
                        <option value="2">2 d√≠as antes</option>
                        <option value="3">3 d√≠as antes</option>
                        <option value="0">No notificar</option>
                    </select>
                </div>
                <div class="notification-setting">
                    <label>Recordatorio alta prioridad:</label>
                    <select id="reminder-high">
                        <option value="1">1 d√≠a antes</option>
                        <option value="2">2 d√≠as antes</option>
                        <option value="3">3 d√≠as antes</option>
                        <option value="0">No notificar</option>
                    </select>
                </div>
                <div class="notification-setting">
                    <label>Recordatorio ex√°menes:</label>
                    <select id="reminder-exam">
                        <option value="1">1 d√≠a antes</option>
                        <option value="2">2 d√≠as antes</option>
                        <option value="3">3 d√≠as antes</option>
                        <option value="0">No notificar</option>
                    </select>
                </div>
            </div>
            
            <div class="settings-item" id="add-google-account">
                <span>Agregar cuenta de Google</span>
                <span>‚ûï</span>
            </div>
            <div class="settings-item logout" id="logout-menu-btn">
                <span>Cerrar sesi√≥n</span>
                <span>üö™</span>
            </div>
        </div>
    </div>

    <!-- Di√°logo personalizado para confirmaciones -->
    <div class="custom-dialog" id="confirm-dialog">
        <div class="custom-dialog-message" id="confirm-message">¬øEst√°s seguro de que quieres eliminar esta tarea?</div>
        <div class="custom-dialog-buttons">
            <button class="custom-dialog-btn cancel" id="confirm-cancel">Cancelar</button>
            <button class="custom-dialog-btn confirm" id="confirm-ok">Eliminar</button>
        </div>
    </div>

    <div id="login-screen" class="login-container">
        <div class="login-box">
            <h1 class="login-title">LOUVLE</h1>
            <p>Organiza tus tareas acad√©micas de manera eficiente</p>
            
            <div class="auth-options">
                <button id="google-login" class="login-btn">
                    <img src="googleimg.png" alt="Google">
                    Iniciar sesi√≥n con Google
                </button>
                
                <button id="skip-login" class="skip-btn">
                    O continuar sin cuenta
                </button>
                
                <div class="terms">
                    Al continuar, aceptas nuestros <a href="#" class="terms-link">T√©rminos de Servicio</a> y <a href="#" class="terms-link">Pol√≠tica de Privacidad</a>.
                </div>
            </div>
        </div>
    </div>

    <div id="app-container" class="app-container">
        <!-- Men√∫ lateral -->
        <div class="sidebar" id="sidebar">
            <div class="logo-title">LOUVLE</div>
            
            <div class="sidebar-header">
                <div class="sidebar-title">Materias</div>
                <button class="close-sidebar" id="close-sidebar">√ó</button>
            </div>
            
            <div class="materias-list" id="materias-list"></div>
            <button class="add-materia-btn" id="abrir-modal-materia">+ Nueva Materia</button>
            
            <!-- Informaci√≥n de login -->
            <div class="login-info" id="login-info">
                <img id="user-avatar" class="user-avatar" src="" alt="Foto de perfil">
                <div id="user-email" class="user-email"></div>
                <button class="logout-btn" id="logout-btn" title="Cerrar sesi√≥n">‚úï</button>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="main-content">
            <div class="header">
                <button class="menu-btn" id="menu-btn">‚ò∞</button>
                <h1 class="app-title">Organizador Acad√©mico</h1>
            </div>

            <!-- Tareas pendientes -->
            <div class="tareas-container" id="tareas-pendientes-container">
                <h2 class="section-title" id="titulo-tareas">Tareas Pendientes</h2>
                <div id="lista-tareas-pendientes"></div>
            </div>

            <!-- Ex√°menes pendientes -->
            <div class="tareas-container" id="examenes-pendientes-container">
                <h2 class="section-title">Ex√°menes Pendientes</h2>
                <div id="lista-examenes-pendientes"></div>
            </div>

            <button class="add-materia-btn" id="abrir-modal-tarea">+ Nueva Tarea</button>
            <button class="add-materia-btn" id="abrir-modal-examen" style="margin-top: 10px; background: var(--color-info); color: white;">+ Nuevo Examen</button>

            <!-- Tareas completadas -->
            <div class="tareas-completadas-container" id="tareas-completadas-container">
                <h2 class="section-title">Tareas Completadas</h2>
                <div id="lista-tareas-completadas"></div>
            </div>

            <!-- Ex√°menes completados -->
            <div class="tareas-completadas-container" id="examenes-completados-container">
                <h2 class="section-title">Ex√°menes Realizados</h2>
                <div id="lista-examenes-completados"></div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar materia -->
    <div class="modal" id="modal-materia">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nueva Materia</h2>
                <button class="close-modal" id="cerrar-modal-materia">√ó</button>
            </div>
            <div class="form-group">
                <label for="nombre-materia">Nombre de la materia</label>
                <input type="text" id="nombre-materia" class="form-control" placeholder="Ej: Matem√°ticas" required>
                <div class="error-message" id="error-nombre-materia">Este campo es obligatorio</div>
            </div>
            <div class="form-group">
                <label for="zona-materia">Puntos de zona</label>
                <input type="number" id="zona-materia" class="form-control" placeholder="Ej: 40" min="1" required>
                <div class="error-message" id="error-zona-materia">Este campo es obligatorio</div>
            </div>
            <button class="btn btn-primary" id="guardar-materia">Guardar</button>
        </div>
    </div>

    <!-- Modal para agregar/editar tarea -->
    <div class="modal" id="modal-tarea">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-tarea-title">Nueva Tarea</h2>
                <button class="close-modal" id="cerrar-modal-tarea">√ó</button>
            </div>
            <div class="form-group">
                <label for="tarea-descripcion">Descripci√≥n</label>
                <input type="text" id="tarea-descripcion" class="form-control" placeholder="Ej: Hacer ejercicios de √°lgebra" required>
                <div class="error-message" id="error-tarea-descripcion">Este campo es obligatorio</div>
            </div>
            <div class="form-group">
                <label for="tarea-puntos">Puntos</label>
                <input type="number" id="tarea-puntos" class="form-control" placeholder="Ej: 10" min="1" required>
                <div class="error-message" id="error-tarea-puntos">Este campo es obligatorio</div>
            </div>
            <div class="form-group">
                <label for="tarea-fecha">Fecha de entrega</label>
                <input type="date" id="tarea-fecha" class="form-control" required>
                <div class="error-message" id="error-tarea-fecha">Este campo es obligatorio</div>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="tarea-prioridad"> Prioridad alta
                </label>
            </div>
            <div class="form-group" id="tarea-status-group">
                <label>Estado</label>
                <div>
                    <label>
                        <input type="radio" name="tarea-status" value="entregada" checked> Entregada
                    </label>
                    <label>
                        <input type="radio" name="tarea-status" value="no-entregada"> No entregada
                    </label>
                </div>
            </div>
            <button class="btn btn-primary" id="guardar-tarea">Guardar</button>
            <button class="btn btn-primary" id="cancelar-tarea" style="background: var(--color-danger); margin-top: 10px;">Cancelar Tarea</button>
        </div>
    </div>

    <!-- Modal para agregar/editar examen -->
    <div class="modal" id="modal-examen">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-examen-title">Nuevo Examen</h2>
                <button class="close-modal" id="cerrar-modal-examen">√ó</button>
            </div>
            <div class="form-group">
                <label for="examen-descripcion">Descripci√≥n</label>
                <input type="text" id="examen-descripcion" class="form-control" placeholder="Ej: Examen parcial de √°lgebra" required>
                <div class="error-message" id="error-examen-descripcion">Este campo es obligatorio</div>
            </div>
            <div class="form-group">
                <label for="examen-puntos">Puntos</label>
                <input type="number" id="examen-puntos" class="form-control" placeholder="Ej: 30" min="1" required>
                <div class="error-message" id="error-examen-puntos">Este campo es obligatorio</div>
            </div>
            <div class="form-group">
                <label for="examen-fecha">Fecha del examen</label>
                <input type="date" id="examen-fecha" class="form-control" required>
                <div class="error-message" id="error-examen-fecha">Este campo es obligatorio</div>
            </div>
            <div class="form-group">
                <label for="examen-utiles">√ötiles necesarios</label>
                <input type="text" id="examen-utiles" class="form-control" placeholder="Ej: Calculadora, cuaderno, libro">
            </div>
            <div class="form-group" id="examen-status-group">
                <label>Estado</label>
                <div>
                    <label>
                        <input type="radio" name="examen-status" value="realizado" checked> Realizado
                    </label>
                    <label>
                        <input type="radio" name="examen-status" value="no-realizado"> No realizado
                    </label>
                </div>
            </div>
            <button class="btn btn-primary" id="guardar-examen">Guardar</button>
        </div>
    </div>

    <script>
        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCjPPKnktrMBmdeOSvus8V5IF4Ce0qEL4Q",
            authDomain: "louvle.firebaseapp.com",
            projectId: "louvle",
            storageBucket: "louvle.firebasestorage.app",
            messagingSenderId: "461018835077",
            appId: "1:461018835077:web:a91eda8324062fd9b161ec",
            measurementId: "G-3W8C962ZG1"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Configurar proveedor de Google
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        googleProvider.setCustomParameters({
            prompt: 'select_account'
        });

        // Variables globales
        let materias = [];
        let tareas = [];
        let examenes = [];
        let materiaSeleccionada = null;
        let tareaEditando = null;
        let examenEditando = null;
        let usuario = null;
        let notificaciones = [];
        let usandoFirebase = false;
        let confirmCallback = null;
        let notificationSettings = {
            normal: 1,
            high: 3,
            exam: 2
        };

        // Elementos del DOM
        const loginScreen = document.getElementById('login-screen');
        const appContainer = document.getElementById('app-container');
        const googleLoginBtn = document.getElementById('google-login');
        const skipLoginBtn = document.getElementById('skip-login');
        const loginInfo = document.getElementById('login-info');
        const userAvatar = document.getElementById('user-avatar');
        const userEmail = document.getElementById('user-email');
        const logoutBtn = document.getElementById('logout-btn');
        const headerLoginBtn = document.getElementById('header-login-btn');
        const headerRegisterBtn = document.getElementById('header-register-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsMenu = document.getElementById('settings-menu');
        const changeThemeBtn = document.getElementById('change-theme-btn');
        const themeOptions = document.getElementById('theme-options');
        const notificationSettingsBtn = document.getElementById('notification-settings-btn');
        const notificationSettingsMenu = document.getElementById('notification-settings');
        const addGoogleAccountBtn = document.getElementById('add-google-account');
        const logoutMenuBtn = document.getElementById('logout-menu-btn');
        const authButtons = document.getElementById('auth-buttons');
        const confirmDialog = document.getElementById('confirm-dialog');
        const confirmMessage = document.getElementById('confirm-message');
        const confirmCancel = document.getElementById('confirm-cancel');
        const confirmOk = document.getElementById('confirm-ok');
        const reminderNormal = document.getElementById('reminder-normal');
        const reminderHigh = document.getElementById('reminder-high');
        const reminderExam = document.getElementById('reminder-exam');

        // Elementos del DOM adicionales
        const tituloTareas = document.getElementById('titulo-tareas');
        const btnNuevaTarea = document.getElementById('abrir-modal-tarea');
        const btnNuevoExamen = document.getElementById('abrir-modal-examen');
        const tareasPendientesContainer = document.getElementById('tareas-pendientes-container');
        const examenesPendientesContainer = document.getElementById('examenes-pendientes-container');
        const tareasCompletadasContainer = document.getElementById('tareas-completadas-container');
        const examenesCompletadosContainer = document.getElementById('examenes-completados-container');
        const materiasList = document.getElementById('materias-list');
        const listaTareasPendientes = document.getElementById('lista-tareas-pendientes');
        const listaExamenesPendientes = document.getElementById('lista-examenes-pendientes');
        const listaTareasCompletadas = document.getElementById('lista-tareas-completadas');
        const listaExamenesCompletados = document.getElementById('lista-examenes-completados');
        const sidebar = document.getElementById('sidebar');

        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            // Ocultar elementos que no deben mostrarse al inicio
            appContainer.style.display = 'none';
            loginInfo.style.display = 'none';
            tareasPendientesContainer.style.display = 'none';
            examenesPendientesContainer.style.display = 'none';
            tareasCompletadasContainer.style.display = 'none';
            examenesCompletadosContainer.style.display = 'none';
            btnNuevaTarea.style.display = 'none';
            btnNuevoExamen.style.display = 'none';
            document.getElementById('tarea-status-group').style.display = 'none';
            document.getElementById('examen-status-group').style.display = 'none';
            document.getElementById('cancelar-tarea').style.display = 'none';
            
            // Configurar eventos
            configurarEventos();
            configurarServiceWorker();
            
            // Verificar sesi√≥n
            verificarSesion();
            
            // Solicitar permisos para notificaciones
            solicitarPermisosNotificaciones();
        });

        function solicitarPermisosNotificaciones() {
            if ('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        mostrarNotificacion('Notificaciones activadas');
                    }
                });
            }
        }

        function configurarEventos() {
            // Eventos de autenticaci√≥n
            googleLoginBtn.addEventListener('click', iniciarSesionGoogle);
            skipLoginBtn.addEventListener('click', usarLocalStorage);
            logoutBtn.addEventListener('click', cerrarSesion);
            headerLoginBtn.addEventListener('click', mostrarLoginScreen);
            headerRegisterBtn.addEventListener('click', mostrarLoginScreen);
            logoutMenuBtn.addEventListener('click', cerrarSesion);
            addGoogleAccountBtn.addEventListener('click', iniciarSesionGoogle);

            // Eventos de configuraci√≥n
            settingsBtn.addEventListener('click', toggleSettingsMenu);
            changeThemeBtn.addEventListener('click', toggleThemeOptions);
            notificationSettingsBtn.addEventListener('click', toggleNotificationSettings);
            
            // Configurar eventos de temas
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', () => {
                    const theme = option.dataset.theme;
                    cambiarTema(theme);
                });
            });

            // Eventos del di√°logo de confirmaci√≥n
            confirmCancel.addEventListener('click', () => {
                confirmDialog.classList.remove('active');
            });
            
            confirmOk.addEventListener('click', () => {
                confirmDialog.classList.remove('active');
                if (confirmCallback) {
                    confirmCallback();
                    confirmCallback = null;
                }
            });

            // Configurar eventos de notificaciones
            reminderNormal.addEventListener('change', (e) => {
                notificationSettings.normal = parseInt(e.target.value);
                guardarConfiguracion();
            });
            
            reminderHigh.addEventListener('change', (e) => {
                notificationSettings.high = parseInt(e.target.value);
                guardarConfiguracion();
            });
            
            reminderExam.addEventListener('change', (e) => {
                notificationSettings.exam = parseInt(e.target.value);
                guardarConfiguracion();
            });

            // Cerrar men√∫ de configuraci√≥n al hacer clic fuera
            document.addEventListener('click', (e) => {
                if (!settingsBtn.contains(e.target) && !settingsMenu.contains(e.target)) {
                    settingsMenu.classList.remove('active');
                    themeOptions.classList.remove('active');
                    notificationSettingsMenu.classList.remove('active');
                }
            });

            // Eventos de materias y tareas
            document.getElementById('abrir-modal-materia').addEventListener('click', () => abrirModal('modal-materia'));
            document.getElementById('cerrar-modal-materia').addEventListener('click', () => cerrarModal('modal-materia'));
            document.getElementById('guardar-materia').addEventListener('click', guardarMateria);
            
            // Configurar eventos del sidebar
            const menuBtn = document.getElementById('menu-btn');
            const closeSidebarBtn = document.getElementById('close-sidebar');
            
            if (menuBtn) menuBtn.addEventListener('click', toggleSidebar);
            if (closeSidebarBtn) closeSidebarBtn.addEventListener('click', toggleSidebar);
            
            document.getElementById('abrir-modal-tarea').addEventListener('click', () => {
                tareaEditando = null;
                document.getElementById('modal-tarea-title').textContent = 'Nueva Tarea';
                document.getElementById('tarea-status-group').style.display = 'none';
                document.getElementById('cancelar-tarea').style.display = 'none';
                // Limpiar formulario
                document.getElementById('tarea-descripcion').value = '';
                document.getElementById('tarea-puntos').value = '';
                document.getElementById('tarea-fecha').value = '';
                document.getElementById('tarea-prioridad').checked = false;
                abrirModal('modal-tarea');
            });
            
            document.getElementById('cerrar-modal-tarea').addEventListener('click', () => cerrarModal('modal-tarea'));
            document.getElementById('guardar-tarea').addEventListener('click', guardarTarea);
            document.getElementById('cancelar-tarea').addEventListener('click', cancelarTarea);
            
            document.getElementById('abrir-modal-examen').addEventListener('click', () => {
                examenEditando = null;
                document.getElementById('modal-examen-title').textContent = 'Nuevo Examen';
                document.getElementById('examen-status-group').style.display = 'none';
                // Limpiar formulario
                document.getElementById('examen-descripcion').value = '';
                document.getElementById('examen-puntos').value = '';
                document.getElementById('examen-fecha').value = '';
                document.getElementById('examen-utiles').value = '';
                abrirModal('modal-examen');
            });
            
            document.getElementById('cerrar-modal-examen').addEventListener('click', () => cerrarModal('modal-examen'));
            document.getElementById('guardar-examen').addEventListener('click', guardarExamen);
            
            // Cargar tema guardado
            const savedTheme = localStorage.getItem('theme') || 'dark';
            cambiarTema(savedTheme);
            
            // Cargar configuraci√≥n de notificaciones
            cargarConfiguracion();
        }

        function cambiarTema(theme) {
            document.body.className = `theme-${theme}`;
            localStorage.setItem('theme', theme);
            
            // Marcar el tema activo
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.theme === theme) {
                    option.classList.add('active');
                }
            });
        }

        function cargarConfiguracion() {
            const savedSettings = localStorage.getItem('notificationSettings');
            if (savedSettings) {
                notificationSettings = JSON.parse(savedSettings);
                reminderNormal.value = notificationSettings.normal;
                reminderHigh.value = notificationSettings.high;
                reminderExam.value = notificationSettings.exam;
            }
        }

        function guardarConfiguracion() {
            localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
        }

        function toggleSettingsMenu(e) {
            e.stopPropagation();
            settingsMenu.classList.toggle('active');
            if (!settingsMenu.classList.contains('active')) {
                themeOptions.classList.remove('active');
                notificationSettingsMenu.classList.remove('active');
            }
        }

        function toggleThemeOptions(e) {
            e.stopPropagation();
            themeOptions.classList.toggle('active');
            if (themeOptions.classList.contains('active')) {
                notificationSettingsMenu.classList.remove('active');
            }
        }

        function toggleNotificationSettings(e) {
            e.stopPropagation();
            notificationSettingsMenu.classList.toggle('active');
            if (notificationSettingsMenu.classList.contains('active')) {
                themeOptions.classList.remove('active');
            }
        }

        function mostrarLoginScreen() {
            loginScreen.style.display = 'flex';
            appContainer.style.display = 'none';
            authButtons.style.display = 'flex';
        }

        function showConfirm(message, callback) {
            confirmMessage.textContent = message;
            confirmCallback = callback;
            confirmDialog.classList.add('active');
        }

        // Funci√≥n para iniciar sesi√≥n con Google
        function iniciarSesionGoogle() {
            auth.signInWithPopup(googleProvider)
                .then((result) => {
                    // Verificar si es un nuevo usuario
                    if (result.additionalUserInfo.isNewUser) {
                        crearPerfilUsuario(result.user);
                    }
                    mostrarNotificacion(`Bienvenido ${result.user.displayName || result.user.email}`);
                })
                .catch(error => {
                    console.error('Error al iniciar sesi√≥n con Google:', error);
                    mostrarNotificacion('Error al iniciar sesi√≥n con Google');
                });
        }

        // Funci√≥n para usar sin autenticaci√≥n
        function usarLocalStorage() {
            usuario = {
                uid: 'local-user-' + Date.now(),
                nombre: "Usuario Local",
                email: "local@example.com",
                foto: "https://i.imgur.com/8Km9tLL.png",
                local: true
            };
            
            localStorage.setItem('usuario', JSON.stringify(usuario));
            usandoFirebase = false;
            
            // Ocultar informaci√≥n de login
            loginInfo.style.display = 'none';
            
            // Mostrar la aplicaci√≥n
            loginScreen.style.display = 'none';
            appContainer.style.display = 'flex';
            
            // Mostrar botones de autenticaci√≥n en el header
            authButtons.style.display = 'flex';
            
            // Cargar datos locales
            cargarDatosLocales();
            
            mostrarNotificacion('Modo local activado - Los datos no se sincronizar√°n');
        }

        // Funci√≥n para verificar la sesi√≥n al cargar
        function verificarSesion() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    // Usuario ha iniciado sesi√≥n
                    handleUserLogin(user);
                } else {
                    // No hay usuario logueado
                    handleUserLogout();
                }
            });
        }

        function handleUserLogin(user) {
            usuario = {
                uid: user.uid,
                nombre: user.displayName || user.email.split('@')[0],
                email: user.email,
                foto: user.photoURL || 'https://i.imgur.com/8Km9tLL.png'
            };
            
            // Mostrar informaci√≥n de usuario
            userAvatar.src = usuario.foto;
            userEmail.textContent = usuario.email;
            loginInfo.style.display = 'flex';
            
            // Ocultar botones de autenticaci√≥n en el header
            authButtons.style.display = 'none';
            
            // Guardar datos de sesi√≥n
            localStorage.setItem('usuario', JSON.stringify(usuario));
            usandoFirebase = true;
            
            // Cargar datos de Firestore
            cargarDatosFirebase();
            
            // Mostrar la aplicaci√≥n
            loginScreen.style.display = 'none';
            appContainer.style.display = 'flex';
        }

        function handleUserLogout() {
            // Verificar si hay datos locales
            const usuarioLocal = JSON.parse(localStorage.getItem('usuario'));
            if (usuarioLocal && usuarioLocal.local) {
                // Usuario prefiri√≥ no iniciar sesi√≥n pero ya tiene datos
                usuario = usuarioLocal;
                usandoFirebase = false;
                
                // Ocultar informaci√≥n de login
                loginInfo.style.display = 'none';
                
                // Mostrar botones de autenticaci√≥n en el header
                authButtons.style.display = 'flex';
                
                // Cargar datos locales
                cargarDatosLocales();
                
                loginScreen.style.display = 'none';
                appContainer.style.display = 'flex';
            } else {
                // Mostrar pantalla de login
                loginScreen.style.display = 'flex';
                appContainer.style.display = 'none';
                
                // Mostrar botones de autenticaci√≥n en el header
                authButtons.style.display = 'flex';
                
                // Limpiar datos de usuario
                usuario = null;
            }
        }

        function crearPerfilUsuario(user) {
            db.collection('usuarios').doc(user.uid).set({
                nombre: user.displayName || user.email.split('@')[0],
                email: user.email,
                fotoURL: user.photoURL || '',
                fechaRegistro: firebase.firestore.FieldValue.serverTimestamp(),
                ultimoAcceso: firebase.firestore.FieldValue.serverTimestamp(),
                configuracion: {
                    tema: 'oscuro',
                    notificaciones: true
                }
            }).then(() => {
                console.log("Perfil de usuario creado");
            }).catch((error) => {
                console.error("Error al crear perfil:", error);
            });
        }

        function cerrarSesion() {
            auth.signOut().then(() => {
                localStorage.removeItem('usuario');
                localStorage.removeItem('materias');
                localStorage.removeItem('tareas');
                localStorage.removeItem('examenes');
                
                usuario = null;
                materias = [];
                tareas = [];
                examenes = [];
                materiaSeleccionada = null;
                
                loginScreen.style.display = 'flex';
                appContainer.style.display = 'none';
                
                // Mostrar botones de autenticaci√≥n en el header
                authButtons.style.display = 'flex';
                
                mostrarNotificacion('Sesi√≥n cerrada correctamente');
            }).catch(error => {
                console.error('Error al cerrar sesi√≥n:', error);
            });
        }

        function cargarDatosFirebase() {
            if (!usuario || !usuario.uid) return;
            
            // Cargar materias
            db.collection('usuarios').doc(usuario.uid).collection('materias').get()
                .then(snapshot => {
                    materias = [];
                    snapshot.forEach(doc => {
                        materias.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Cargar tareas
                    return db.collection('usuarios').doc(usuario.uid).collection('tareas').get();
                })
                .then(snapshot => {
                    tareas = [];
                    snapshot.forEach(doc => {
                        tareas.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Cargar ex√°menes
                    return db.collection('usuarios').doc(usuario.uid).collection('examenes').get();
                })
                .then(snapshot => {
                    examenes = [];
                    snapshot.forEach(doc => {
                        examenes.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Renderizar datos
                    renderizarMaterias();
                    verificarRecordatorios();
                })
                .catch(error => {
                    console.error('Error al cargar datos:', error);
                    mostrarNotificacion('Error al cargar datos. Usando datos locales');
                    
                    // Intentar cargar datos locales como respaldo
                    cargarDatosLocales();
                });
        }

        function cargarDatosLocales() {
            materias = JSON.parse(localStorage.getItem('materias')) || [];
            tareas = JSON.parse(localStorage.getItem('tareas')) || [];
            examenes = JSON.parse(localStorage.getItem('examenes')) || [];
            
            renderizarMaterias();
            verificarRecordatorios();
        }

        function guardarDatos() {
            if (usandoFirebase && usuario && usuario.uid) {
                // Guardar en Firebase
                const batch = db.batch();
                const userRef = db.collection('usuarios').doc(usuario.uid);
                
                // Limpiar datos anteriores (en una implementaci√≥n real usar√≠as actualizaciones incrementales)
                batch.set(userRef, { lastUpdate: firebase.firestore.FieldValue.serverTimestamp() });
                
                // Guardar materias
                materias.forEach(materia => {
                    const materiaRef = userRef.collection('materias').doc(materia.id);
                    batch.set(materiaRef, {
                        nombre: materia.nombre,
                        zona: materia.zona
                    });
                });
                
                // Guardar tareas
                tareas.forEach(tarea => {
                    const tareaRef = userRef.collection('tareas').doc(tarea.id);
                    batch.set(tareaRef, {
                        materia: tarea.materia,
                        descripcion: tarea.descripcion,
                        puntos: tarea.puntos,
                        fechaEntrega: tarea.fechaEntrega,
                        prioridad: tarea.prioridad,
                        completada: tarea.completada,
                        entregada: tarea.entregada,
                        tipo: tarea.tipo
                    });
                });
                
                // Guardar ex√°menes
                examenes.forEach(examen => {
                    const examenRef = userRef.collection('examenes').doc(examen.id);
                    batch.set(examenRef, {
                        materia: examen.materia,
                        descripcion: examen.descripcion,
                        puntos: examen.puntos,
                        fecha: examen.fecha,
                        utiles: examen.utiles,
                        completado: examen.completado,
                        realizado: examen.realizado,
                        tipo: examen.tipo
                    });
                });
                
                batch.commit().then(() => {
                    console.log('Datos guardados en Firebase');
                }).catch(error => {
                    console.error('Error al guardar en Firebase:', error);
                    // Guardar localmente como respaldo
                    guardarDatosLocales();
                });
            } else {
                // Guardar localmente
                guardarDatosLocales();
            }
        }

        function guardarDatosLocales() {
            localStorage.setItem('materias', JSON.stringify(materias));
            localStorage.setItem('tareas', JSON.stringify(tareas));
            localStorage.setItem('examenes', JSON.stringify(examenes));
        }

        function configurarServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registrado con √©xito');
                }).catch(err => {
                    console.log('Error al registrar ServiceWorker:', err);
                });
            }
        }

        function verificarRecordatorios() {
            const hoy = new Date().toISOString().split('T')[0];
            
            // Verificar tareas normales seg√∫n configuraci√≥n
            if (notificationSettings.normal > 0) {
                const tareasNormales = tareas.filter(t => {
                    if (t.completada || t.prioridad === 'alta') return false;
                    
                    const fechaEntrega = new Date(t.fechaEntrega);
                    const hoyDate = new Date(hoy);
                    const diffTime = fechaEntrega - hoyDate;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    return diffDays === notificationSettings.normal;
                });
                
                tareasNormales.forEach(tarea => {
                    const mensaje = `Tarea pendiente para ${notificationSettings.normal} d√≠a(s): ${tarea.descripcion} (${tarea.materia})`;
                    mostrarNotificacion(mensaje);
                    enviarNotificacionPush(mensaje);
                });
            }
            
            // Verificar tareas de alta prioridad seg√∫n configuraci√≥n
            if (notificationSettings.high > 0) {
                const tareasAltaPrioridad = tareas.filter(t => {
                    if (t.completada || t.prioridad !== 'alta') return false;
                    
                    const fechaEntrega = new Date(t.fechaEntrega);
                    const hoyDate = new Date(hoy);
                    const diffTime = fechaEntrega - hoyDate;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    return diffDays === notificationSettings.high;
                });
                
                tareasAltaPrioridad.forEach(tarea => {
                    const mensaje = `RECUERDA: Tarea de alta prioridad para ${notificationSettings.high} d√≠a(s) (${tarea.materia})`;
                    mostrarNotificacion(mensaje);
                    enviarNotificacionPush(mensaje);
                });
            }
            
            // Verificar ex√°menes seg√∫n configuraci√≥n
            if (notificationSettings.exam > 0) {
                const examenesProximos = examenes.filter(e => {
                    if (e.completado) return false;
                    
                    const fechaExamen = new Date(e.fecha);
                    const hoyDate = new Date(hoy);
                    const diffTime = fechaExamen - hoyDate;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    return diffDays === notificationSettings.exam;
                });
                
                examenesProximos.forEach(examen => {
                    const mensaje = `EXAMEN PR√ìXIMO en ${notificationSettings.exam} d√≠a(s): ${examen.descripcion} (${examen.materia}). √ötiles: ${examen.utiles || 'Ninguno especificado'}`;
                    mostrarNotificacion(mensaje);
                    enviarNotificacionPush(mensaje);
                });
            }
            
            // Guardar notificaciones mostradas
            notificaciones = [...tareasNormales.map(t => t.id), ...tareasAltaPrioridad.map(t => t.id), ...examenesProximos.map(e => e.id)];
            localStorage.setItem('notificaciones', JSON.stringify(notificaciones));
        }

        function enviarNotificacionPush(mensaje) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('Recordatorio', { body: mensaje });
            }
        }

        function toggleSidebar() {
            if (sidebar) sidebar.classList.toggle('active');
        }

        function abrirModal(id) {
            // Limpiar errores
            document.querySelectorAll(`#${id} .error-message`).forEach(el => {
                el.style.display = 'none';
            });
            document.querySelectorAll(`#${id} .form-control`).forEach(el => {
                el.classList.remove('error');
            });
            
            document.getElementById(id).classList.add('active');
        }

        function cerrarModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function mostrarError(campoId, mensajeId) {
            document.getElementById(campoId).classList.add('error');
            document.getElementById(mensajeId).style.display = 'block';
            
            // Animaci√≥n de vibraci√≥n
            document.getElementById(campoId).style.animation = 'none';
            void document.getElementById(campoId).offsetWidth; // Trigger reflow
            document.getElementById(campoId).style.animation = 'vibrate 0.5s';
        }

        function validarFormulario(modalId) {
            let valido = true;
            const modal = document.getElementById(modalId);
            
            // Validar campos obligatorios
            modal.querySelectorAll('[required]').forEach(input => {
                if (!input.value.trim()) {
                    const errorId = `error-${input.id}`;
                    mostrarError(input.id, errorId);
                    valido = false;
                }
            });
            
            return valido;
        }

        function guardarMateria() {
            if (!validarFormulario('modal-materia')) return;
            
            const nombreMateria = document.getElementById('nombre-materia').value.trim();
            const zonaMateria = parseInt(document.getElementById('zona-materia').value) || 0;

            if (materias.some(m => m.nombre === nombreMateria)) {
                mostrarError('nombre-materia', 'error-nombre-materia');
                document.getElementById('error-nombre-materia').textContent = 'Esta materia ya existe';
                document.getElementById('error-nombre-materia').style.display = 'block';
                return;
            }

            const nuevaMateria = {
                id: Date.now().toString(),
                nombre: nombreMateria,
                zona: zonaMateria
            };
            
            materias.push(nuevaMateria);
            guardarDatos();
            renderizarMaterias();
            
            // Limpiar formulario
            document.getElementById('nombre-materia').value = '';
            document.getElementById('zona-materia').value = '';
            
            cerrarModal('modal-materia');
            mostrarNotificacion(`Materia "${nombreMateria}" agregada`);
        }

        function eliminarMateria(id) {
            showConfirm('¬øEliminar esta materia y todas sus tareas y ex√°menes asociados?', () => {
                // Eliminar tareas y ex√°menes asociados
                const nombreMateria = materias.find(m => m.id === id)?.nombre;
                if (nombreMateria) {
                    tareas = tareas.filter(t => t.materia !== nombreMateria);
                    examenes = examenes.filter(e => e.materia !== nombreMateria);
                }
                
                // Eliminar la materia
                materias = materias.filter(m => m.id !== id);
                
                // Si la materia eliminada era la seleccionada, limpiar la selecci√≥n
                if (materiaSeleccionada && materiaSeleccionada.id === id) {
                    materiaSeleccionada = null;
                    tituloTareas.textContent = 'Tareas Pendientes';
                    btnNuevaTarea.style.display = 'none';
                    btnNuevoExamen.style.display = 'none';
                    tareasPendientesContainer.style.display = 'none';
                    examenesPendientesContainer.style.display = 'none';
                    tareasCompletadasContainer.style.display = 'none';
                    examenesCompletadosContainer.style.display = 'none';
                }
                
                guardarDatos();
                renderizarMaterias();
                
                mostrarNotificacion('Materia eliminada');
            });
        }

        function seleccionarMateria(materia) {
            materiaSeleccionada = materia;
            
            // Actualizar UI
            document.querySelectorAll('.materia-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.id == materia.id) {
                    item.classList.add('active');
                }
            });
            
            // Mostrar contenido de la materia seleccionada
            tituloTareas.textContent = `Tareas de ${materia.nombre}`;
            btnNuevaTarea.style.display = 'block';
            btnNuevoExamen.style.display = 'block';

            renderizarTareasPendientes();
            renderizarExamenesPendientes();
            renderizarTareasCompletadas();
            renderizarExamenesCompletados();

            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
        }

        function renderizarMaterias() {
            materiasList.innerHTML = '';
            
            if (materias.length === 0) {
                materiasList.innerHTML = '<p>No hay materias registradas</p>';
                return;
            }
            
            materias.forEach(materia => {
                const materiaElement = document.createElement('div');
                materiaElement.className = 'materia-item';
                materiaElement.dataset.id = materia.id;
                
                const materiaContent = document.createElement('div');
                materiaContent.innerHTML = `
                    <div>${materia.nombre}</div>
                    <div class="materia-info">
                        Entregados: ${tareas
                            .filter(t => t.materia === materia.nombre && t.completada && t.entregada)
                            .reduce((sum, t) => sum + t.puntos, 0)}/${materia.zona}
                    </div>
                `;
                
                const materiaActions = document.createElement('div');
                materiaActions.className = 'materia-actions';
                materiaActions.innerHTML = `
                    <button class="materia-btn eliminar" onclick="app.eliminarMateria('${materia.id}')">√ó</button>
                `;
                
                materiaElement.appendChild(materiaContent);
                materiaElement.appendChild(materiaActions);
                
                materiaElement.addEventListener('click', (e) => {
                    // Evitar que el clic en los botones de acci√≥n active la selecci√≥n
                    if (!e.target.closest('.materia-actions')) {
                        seleccionarMateria(materia);
                    }
                });
                
                materiasList.appendChild(materiaElement);
            });
        }

        function renderizarTareasPendientes() {
            listaTareasPendientes.innerHTML = '';
            
            if (!materiaSeleccionada) {
                tareasPendientesContainer.style.display = 'none';
                return;
            }
            
            const tareasMateria = tareas.filter(t => 
                t.materia === materiaSeleccionada.nombre && !t.completada
            );
            
            if (tareasMateria.length === 0) {
                tareasPendientesContainer.style.display = 'none';
                return;
            }
            
            tareasPendientesContainer.style.display = 'block';
            
            tareasMateria.forEach(tarea => {
                const tareaItem = document.createElement('div');
                tareaItem.className = 'tarea-item';
                
                tareaItem.innerHTML = `
                    <div class="tarea-info">
                        <div class="tarea-title">
                            <span class="tarea-prioridad ${tarea.prioridad === 'alta' ? 'prioridad-alta' : 'prioridad-normal'}"></span>
                            ${tarea.descripcion}
                            <span class="tarea-puntos">${tarea.puntos} pts</span>
                        </div>
                        <div class="tarea-descripcion">${tarea.materia}</div>
                        <div class="tarea-fecha">Entrega: ${tarea.fechaEntrega}</div>
                    </div>
                    <div class="tarea-actions">
                        <button class="tarea-btn completar" data-id="${tarea.id}">‚úì</button>
                        <button class="tarea-btn editar" data-id="${tarea.id}">‚úèÔ∏è</button>
                        <button class="tarea-btn eliminar" data-id="${tarea.id}">√ó</button>
                    </div>
                `;
                
                // Agregar eventos a los botones
                tareaItem.querySelector('.tarea-btn.completar').addEventListener('click', () => completarTarea(tarea.id, true));
                tareaItem.querySelector('.tarea-btn.editar').addEventListener('click', () => editarTarea(tarea.id));
                tareaItem.querySelector('.tarea-btn.eliminar').addEventListener('click', () => {
                    showConfirm('¬øEliminar esta tarea permanentemente?', () => eliminarTarea(tarea.id));
                });
                
                listaTareasPendientes.appendChild(tareaItem);
            });
        }

        function renderizarExamenesPendientes() {
            listaExamenesPendientes.innerHTML = '';
            
            if (!materiaSeleccionada) {
                examenesPendientesContainer.style.display = 'none';
                return;
            }
            
            const examenesMateria = examenes.filter(e => 
                e.materia === materiaSeleccionada.nombre && !e.completado
            );
            
            if (examenesMateria.length === 0) {
                examenesPendientesContainer.style.display = 'none';
                return;
            }
            
            examenesPendientesContainer.style.display = 'block';
            
            examenesMateria.forEach(examen => {
                const examenItem = document.createElement('div');
                examenItem.className = 'tarea-item';
                
                examenItem.innerHTML = `
                    <div class="tarea-info">
                        <div class="tarea-title">
                            <span class="tarea-prioridad prioridad-alta"></span>
                            ${examen.descripcion}
                            <span class="tarea-puntos">${examen.puntos} pts</span>
                        </div>
                        <div class="tarea-descripcion">${examen.materia}</div>
                        <div class="tarea-fecha">Fecha: ${examen.fecha}</div>
                        ${examen.utiles ? `<div class="tarea-descripcion">√ötiles: ${examen.utiles}</div>` : ''}
                    </div>
                    <div class="tarea-actions">
                        <button class="tarea-btn completar" data-id="${examen.id}">‚úì</button>
                        <button class="tarea-btn editar" data-id="${examen.id}">‚úèÔ∏è</button>
                        <button class="tarea-btn eliminar" data-id="${examen.id}">√ó</button>
                    </div>
                `;
                
                // Agregar eventos a los botones
                examenItem.querySelector('.tarea-btn.completar').addEventListener('click', () => completarExamen(examen.id, true));
                examenItem.querySelector('.tarea-btn.editar').addEventListener('click', () => editarExamen(examen.id));
                examenItem.querySelector('.tarea-btn.eliminar').addEventListener('click', () => {
                    showConfirm('¬øEliminar este examen permanentemente?', () => eliminarExamen(examen.id));
                });
                
                listaExamenesPendientes.appendChild(examenItem);
            });
        }

        function renderizarTareasCompletadas() {
            listaTareasCompletadas.innerHTML = '';
            
            if (!materiaSeleccionada) {
                tareasCompletadasContainer.style.display = 'none';
                return;
            }
            
            const tareasCompletadas = tareas.filter(t => 
                t.materia === materiaSeleccionada.nombre && t.completada
            );
            
            if (tareasCompletadas.length === 0) {
                tareasCompletadasContainer.style.display = 'none';
                return;
            }
            
            tareasCompletadasContainer.style.display = 'block';
            
            tareasCompletadas.forEach(tarea => {
                const tareaItem = document.createElement('div');
                tareaItem.className = `tarea-completada ${tarea.entregada ? 'entregada' : 'no-entregada'}`;
                
                tareaItem.innerHTML = `
                    <div class="tarea-completada-info">
                        <div>${tarea.descripcion}</div>
                        <div class="tarea-fecha">Entrega: ${tarea.fechaEntrega}</div>
                    </div>
                    <div>
                        <span class="tarea-completada-status ${tarea.entregada ? 'entregada-text' : 'no-entregada-text'}">
                            ${tarea.entregada ? 'Entregada' : 'No entregada'}
                        </span>
                        <span class="tarea-puntos">${tarea.puntos} pts</span>
                        <button class="tarea-btn eliminar" data-id="${tarea.id}" style="margin-left: 10px;">√ó</button>
                    </div>
                `;
                
                // Agregar evento al bot√≥n de eliminar
                tareaItem.querySelector('.tarea-btn.eliminar').addEventListener('click', () => {
                    showConfirm('¬øEliminar esta tarea permanentemente?', () => eliminarTarea(tarea.id));
                });
                
                listaTareasCompletadas.appendChild(tareaItem);
            });
        }

        function renderizarExamenesCompletados() {
            listaExamenesCompletados.innerHTML = '';
            
            if (!materiaSeleccionada) {
                examenesCompletadosContainer.style.display = 'none';
                return;
            }
            
            const examenesCompletados = examenes.filter(e => 
                e.materia === materiaSeleccionada.nombre && e.completado
            );
            
            if (examenesCompletados.length === 0) {
                examenesCompletadosContainer.style.display = 'none';
                return;
            }
            
            examenesCompletadosContainer.style.display = 'block';
            
            examenesCompletados.forEach(examen => {
                const examenItem = document.createElement('div');
                examenItem.className = `tarea-completada ${examen.realizado ? 'entregada' : 'no-entregada'}`;
                
                examenItem.innerHTML = `
                    <div class="tarea-completada-info">
                        <div>${examen.descripcion}</div>
                        <div class="tarea-fecha">Fecha: ${examen.fecha}</div>
                    </div>
                    <div>
                        <span class="tarea-completada-status ${examen.realizado ? 'entregada-text' : 'no-entregada-text'}">
                            ${examen.realizado ? 'Realizado' : 'No realizado'}
                        </span>
                        <span class="tarea-puntos">${examen.puntos} pts</span>
                        <button class="tarea-btn eliminar" data-id="${examen.id}" style="margin-left: 10px;">√ó</button>
                    </div>
                `;
                
                // Agregar evento al bot√≥n de eliminar
                examenItem.querySelector('.tarea-btn.eliminar').addEventListener('click', () => {
                    showConfirm('¬øEliminar este examen permanentemente?', () => eliminarExamen(examen.id));
                });
                
                listaExamenesCompletados.appendChild(examenItem);
            });
        }

        function editarTarea(id) {
            tareaEditando = tareas.find(t => t.id === id);
            if (!tareaEditando) return;
            
            document.getElementById('modal-tarea-title').textContent = 'Editar Tarea';
            document.getElementById('tarea-descripcion').value = tareaEditando.descripcion;
            document.getElementById('tarea-puntos').value = tareaEditando.puntos;
            document.getElementById('tarea-fecha').value = tareaEditando.fechaEntrega;
            document.getElementById('tarea-prioridad').checked = tareaEditando.prioridad === 'alta';
            
            document.getElementById('tarea-status-group').style.display = 'block';
            document.querySelector(`input[name="tarea-status"][value="${tareaEditando.entregada ? 'entregada' : 'no-entregada'}"]`).checked = true;
            
            document.getElementById('cancelar-tarea').style.display = 'block';
            abrirModal('modal-tarea');
        }

        function guardarTarea() {
            if (!validarFormulario('modal-tarea')) return;
            
            const descripcion = document.getElementById('tarea-descripcion').value.trim();
            const puntos = parseInt(document.getElementById('tarea-puntos').value) || 0;
            const fechaEntrega = document.getElementById('tarea-fecha').value;
            const prioridad = document.getElementById('tarea-prioridad').checked ? 'alta' : 'normal';
            const entregada = tareaEditando ? 
                document.querySelector('input[name="tarea-status"]:checked').value === 'entregada' : true;

            if (tareaEditando) {
                // Editar tarea existente
                tareaEditando.descripcion = descripcion;
                tareaEditando.puntos = puntos;
                tareaEditando.fechaEntrega = fechaEntrega;
                tareaEditando.prioridad = prioridad;
                tareaEditando.entregada = entregada;
                
                mostrarNotificacion('Tarea actualizada');
            } else {
                // Nueva tarea
                const nuevaTarea = {
                    id: Date.now().toString(),
                    materia: materiaSeleccionada.nombre,
                    descripcion,
                    puntos,
                    fechaEntrega,
                    prioridad,
                    completada: false,
                    entregada: true,
                    tipo: 'tarea'
                };
                tareas.push(nuevaTarea);
                
                mostrarNotificacion('Tarea agregada');
                
                // Programar recordatorios
                programarRecordatoriosTarea(nuevaTarea);
            }
            
            guardarDatos();
            renderizarTareasPendientes();
            renderizarTareasCompletadas();
            renderizarMaterias();
            cerrarModal('modal-tarea');
        }

        function programarRecordatoriosTarea(tarea) {
            const fechaEntrega = new Date(tarea.fechaEntrega);
            const hoy = new Date();
            
            // Diferencia en d√≠as
            const diffTime = fechaEntrega - hoy;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // Programar notificaciones seg√∫n prioridad
            if (tarea.prioridad === 'alta' && notificationSettings.high > 0) {
                if (diffDays >= notificationSettings.high) {
                    const notificacionFecha = new Date(fechaEntrega);
                    notificacionFecha.setDate(notificacionFecha.getDate() - notificationSettings.high);
                    
                    // En una implementaci√≥n real usar√≠as el API de notificaciones push
                    console.log(`Recordatorio programado para ${notificacionFecha.toISOString()}: Tarea de alta prioridad "${tarea.descripcion}"`);
                }
            } else if (notificationSettings.normal > 0) {
                if (diffDays >= notificationSettings.normal) {
                    const notificacionFecha = new Date(fechaEntrega);
                    notificacionFecha.setDate(notificacionFecha.getDate() - notificationSettings.normal);
                    
                    console.log(`Recordatorio programado para ${notificacionFecha.toISOString()}: Tarea "${tarea.descripcion}"`);
                }
            }
        }

        function cancelarTarea() {
            showConfirm('¬øCancelar esta tarea?', () => {
                tareaEditando.completada = true;
                tareaEditando.entregada = false;
                
                guardarDatos();
                renderizarTareasPendientes();
                renderizarTareasCompletadas();
                renderizarMaterias();
                cerrarModal('modal-tarea');
                
                mostrarNotificacion('Tarea cancelada');
            });
        }

        function completarTarea(id, entregada) {
            const tarea = tareas.find(t => t.id === id);
            if (!tarea) return;
            
            tarea.completada = true;
            tarea.entregada = entregada;
            
            if (entregada) {
                mostrarNotificacion(`Tarea entregada: +${tarea.puntos} puntos`);
            } else {
                mostrarNotificacion('Tarea marcada como no entregada');
            }
            
            guardarDatos();
            
            // Animaci√≥n de desaparici√≥n
            const tareaElement = document.querySelector(`.tarea-item button.completar[data-id="${id}"]`)?.closest('.tarea-item');
            if (tareaElement) {
                tareaElement.classList.add('fade-out');
                
                setTimeout(() => {
                    renderizarTareasPendientes();
                    renderizarTareasCompletadas();
                    renderizarMaterias();
                }, 300);
            } else {
                renderizarTareasPendientes();
                renderizarTareasCompletadas();
                renderizarMaterias();
            }
        }

        function eliminarTarea(id) {
            tareas = tareas.filter(t => t.id !== id);
            guardarDatos();
            
            renderizarTareasPendientes();
            renderizarTareasCompletadas();
            renderizarMaterias();
            
            mostrarNotificacion('Tarea eliminada');
        }

        function editarExamen(id) {
            examenEditando = examenes.find(e => e.id === id);
            if (!examenEditando) return;
            
            document.getElementById('modal-examen-title').textContent = 'Editar Examen';
            document.getElementById('examen-descripcion').value = examenEditando.descripcion;
            document.getElementById('examen-puntos').value = examenEditando.puntos;
            document.getElementById('examen-fecha').value = examenEditando.fecha;
            document.getElementById('examen-utiles').value = examenEditando.utiles || '';
            
            document.getElementById('examen-status-group').style.display = 'block';
            document.querySelector(`input[name="examen-status"][value="${examenEditando.realizado ? 'realizado' : 'no-realizado'}"]`).checked = true;
            
            abrirModal('modal-examen');
        }

        function guardarExamen() {
            if (!validarFormulario('modal-examen')) return;
            
            const descripcion = document.getElementById('examen-descripcion').value.trim();
            const puntos = parseInt(document.getElementById('examen-puntos').value) || 0;
            const fecha = document.getElementById('examen-fecha').value;
            const utiles = document.getElementById('examen-utiles').value.trim();
            const realizado = examenEditando ? 
                document.querySelector('input[name="examen-status"]:checked').value === 'realizado' : false;

            if (examenEditando) {
                // Editar examen existente
                examenEditando.descripcion = descripcion;
                examenEditando.puntos = puntos;
                examenEditando.fecha = fecha;
                examenEditando.utiles = utiles;
                examenEditando.realizado = realizado;
                
                mostrarNotificacion('Examen actualizado');
            } else {
                // Nuevo examen
                const nuevoExamen = {
                    id: Date.now().toString(),
                    materia: materiaSeleccionada.nombre,
                    descripcion,
                    puntos,
                    fecha,
                    utiles,
                    completado: false,
                    realizado: false,
                    tipo: 'examen'
                };
                examenes.push(nuevoExamen);
                
                mostrarNotificacion('Examen agregado');
                
                // Programar recordatorios
                programarRecordatoriosExamen(nuevoExamen);
            }
            
            guardarDatos();
            renderizarExamenesPendientes();
            renderizarExamenesCompletados();
            renderizarMaterias();
            cerrarModal('modal-examen');
        }

        function programarRecordatoriosExamen(examen) {
            if (notificationSettings.exam <= 0) return;
            
            const fechaExamen = new Date(examen.fecha);
            const hoy = new Date();
            
            // Diferencia en d√≠as
            const diffTime = fechaExamen - hoy;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // Recordatorio seg√∫n configuraci√≥n
            if (diffDays >= notificationSettings.exam) {
                const notificacionFecha = new Date(fechaExamen);
                notificacionFecha.setDate(notificacionFecha.getDate() - notificationSettings.exam);
                
                // En una implementaci√≥n real usar√≠as el API de notificaciones push
                console.log(`Recordatorio programado para ${notificacionFecha.toISOString()}: Examen "${examen.descripcion}" - √ötiles: ${examen.utiles || 'Ninguno'}`);
            }
        }

        function completarExamen(id, realizado) {
            const examen = examenes.find(e => e.id === id);
            if (!examen) return;
            
            examen.completado = true;
            examen.realizado = realizado;
            
            if (realizado) {
                mostrarNotificacion(`Examen realizado: +${examen.puntos} puntos`);
            } else {
                mostrarNotificacion('Examen marcado como no realizado');
            }
            
            guardarDatos();
            
            // Animaci√≥n de desaparici√≥n
            const examenElement = document.querySelector(`.tarea-item button.completar[data-id="${id}"]`)?.closest('.tarea-item');
            if (examenElement) {
                examenElement.classList.add('fade-out');
                
                setTimeout(() => {
                    renderizarExamenesPendientes();
                    renderizarExamenesCompletados();
                    renderizarMaterias();
                }, 300);
            } else {
                renderizarExamenesPendientes();
                renderizarExamenesCompletados();
                renderizarMaterias();
            }
        }

        function eliminarExamen(id) {
            examenes = examenes.filter(e => e.id !== id);
            guardarDatos();
            
            renderizarExamenesPendientes();
            renderizarExamenesCompletados();
            renderizarMaterias();
            
            mostrarNotificacion('Examen eliminado');
        }

        function mostrarNotificacion(mensaje) {
            const notificacion = document.createElement('div');
            notificacion.className = 'notificacion';
            notificacion.textContent = mensaje;
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.classList.add('fade-out');
                setTimeout(() => notificacion.remove(), 300);
            }, 3000);
        }

        function verificarTareasVencidas() {
            const hoy = new Date();
            const tareasVencidas = tareas.filter(t => {
                if (t.completada) return false;
                
                const fechaEntrega = new Date(t.fechaEntrega);
                return fechaEntrega < hoy;
            });
            
            tareasVencidas.forEach(tarea => {
                mostrarNotificacion(`Tarea vencida: ${tarea.descripcion} (${tarea.materia})`);
            });
        }

        // Objeto global para acceder a las funciones desde HTML
        window.app = {
            eliminarMateria,
            completarTarea,
            editarTarea,
            eliminarTarea,
            completarExamen,
            editarExamen,
            eliminarExamen
        };
    </script>
</body>
</html>